/*
 * CANCom.c
 *
 *  Created on: Dec 11, 2023
 *      Author: nhakh
 */

#include "main.h"
#include "CANCom.h"

extern CAN_HandleTypeDef hcan;

void CANCom_Init() {
	CAN_FilterTypeDef RxFilter = {
			.FilterActivation = CAN_FILTER_ENABLE,
			.FilterBank = 0,
			.FilterFIFOAssignment = CAN_RX_FIFO0,
			.FilterIdHigh = RX_ID << 5,
			.FilterIdLow = 0,
			.FilterMaskIdHigh = 0,
			.FilterMaskIdLow = 0,
			.FilterMode = CAN_FILTERMODE_IDMASK,
			.FilterScale = CAN_FILTERSCALE_16BIT, };
	HAL_CAN_ConfigFilter(&hcan, &RxFilter);
	HAL_CAN_ActivateNotification(&hcan, CAN_IT_RX_FIFO0_MSG_PENDING);

	HAL_CAN_Start(&hcan);
}

void CANCom_Transmit(uint8_t *pData, uint8_t len) {
	CAN_TxHeaderTypeDef TxHeader;
	TxHeader.DLC = len;
	TxHeader.IDE = CAN_ID_STD;
	TxHeader.RTR = CAN_RTR_DATA;
	TxHeader.StdId = TX_ID;
	uint8_t Mailbox;
	HAL_CAN_AddTxMessage(&hcan, pHeader, aData, pTxMailbox)
}

void CANCom_ReceiveCallback();
